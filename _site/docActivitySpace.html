<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The ActivitySpace structures store information about who is at risk at each feeding station. Each riskList stores information from a human Activity.Space alg...">
<meta name="keywords" content=" ">
<title>Activity Space Documentation | MASH</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://idratherbewriting.comfeed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> MASH</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="https://github.com/smitdave/MASH-Development" target="_blank">MASH on GitHub</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<li><a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:smitdave@uw.edu?subject=MASH Feedback f eedback&body=I have some feedback about the Activity Space Documentation page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a><li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Activity Space Documentation">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          












<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">MASH 0.75</li>
    
    
    
        
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="main.html">Get started</a></li>
            
            
            
            
            
            
            <li><a href="oveDevTeam.html">The Team</a></li>
            
            
            
            
            
            
            <li><a href="news.html">News</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Release Notes</a>
        <ul>
            
            
            
            <li><a href="relRelease10.html">Release Notes 1.0</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Documentation</a>
        <ul>
            
            
            
            <li><a href="docOverview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="docGitHub.html">GitHub</a></li>
            
            
            
            
            
            
            <li><a href="docStructure.html">Structure</a></li>
            
            
            
            
            
            
            <li><a href="docStyle.html">Style</a></li>
            
            
            
            
            
            
            <li><a href="docMosquito.html">Mosquito</a></li>
            
            
            
            
            
            
            <li><a href="docHumans.html">Human</a></li>
            
            
            
            
            
            
            <li class="active"><a href="docActivitySpace.html">Activity Space</a></li>
            
            
            
            
            
            
            <li><a href="docAqua.html">Aquatic Ecology</a></li>
            
            
            
            
            
            
            <li><a href="docDHM.html">DHM</a></li>
            
            
            
            
            
            
            <li><a href="docDHM-Basic.html">DHM-Basic</a></li>
            
            
            
            
            
            
            <li><a href="docDHMP.html">DHM Parameters</a></li>
            
            
            
            
            
            
            <li><a href="docPathogens.html">Pathogens</a></li>
            
            
            
            
            
            
            <li><a href="docVectorControl.html">Vector Control</a></li>
            
            
            
            
            
            
            <li><a href="docKnownBugs.html">Known Bugs</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Licensing and Publications</a>
        <ul>
            
            
            
            <li><a href="licLicense.html">License</a></li>
            
            
            
            
            
            
            <li><a href="licPublications.html">Publications</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Activity Space Documentation</h1>
</div>



<div class="post-content">

   
    <div class="summary">The ActivitySpace structures store information about who is at risk at each feeding station. Each riskList stores information from a human Activity.Space algorithm and is used by a corresponding chooseHost function. These are called only by MICRO as location is resolved only to the patch level in MACRO.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

    

    

    

  <h2 id="timeatrisk">TimeAtRisk</h2>
<p>atRisk.daily models total daily risk: The list stores the id of the human and the proportion of their time at risk.</p>

<h2 id="risklist">riskList</h2>
<p>The riskList describes the distribution of human time at risk across the feeding sites on the landscape. The riskList models total daily risk; the list stores the id of the human and the proportion of their time at risk. Besides humans, there are a list of “other” hosts that a mosquito may encounter:</p>

<ol>
  <li>livestock = -1</li>
  <li>ivermectin.livestock = -2</li>
  <li>sugar = -3 <em>DEPRECATED:</em> sugar sources are now independent landscape objects</li>
  <li>atsb = -4</li>
  <li>bloodtrap = -5</li>
</ol>

<p>The structure of the riskList follows:</p>

<ul>
  <li>N.d: number of days which risk is modeled for (this is a rolling window in model time).</li>
  <li>today: integer vector of which days risk is modeled for.</li>
  <li>atRisk: a list of length equal to N.d; each element is a risk structure for that day.
    <ul>
      <li>N.f: number of feeding sites for which risk is calculated for (typically set to all sites on the landscape).</li>
      <li>maxH: the number of humans for which risk is calculated for.</li>
      <li>N: an integer vector of length equal to N.f; each element is the number of humans at risk at that site at any point on that day.</li>
      <li>pTm: percent of time that human i is at risk at that feeding site.</li>
      <li>w: biting weight for human i at that feeding site (distributed as rgamma(1,1,1)).</li>
    </ul>
  </li>
  <li>N.o: number of non-human hosts being modeled.</li>
  <li>other: a list of length equal to N.o which models risk for non-human hosts.
    <ul>
      <li>zoo: risk for livestock.
        <ul>
          <li>w: numeric vector of gamma distributed biting weights; rgamma(N.f,1,1)/3</li>
          <li>typeID: type of the non-human host.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="activityspace">activitySpace</h2>
<p>The activitySpace functions simulate how each human moves and distributes their time at risk across the feeding sites on the landscape.</p>

<ul>
  <li>activitySpace.daily.Np.i: this function puts human i in the atRisk list of riskList for day t.
    <ol>
      <li>p.d: proportion of time human i spends at their home feeding site on day t.</li>
      <li>add1toAtRisk.daily: this adds human i’s risk at home to the atRisk object at day ix, home hhID, human myID, proportion of risk at home p.d, and biting weight w.</li>
      <li>n.d: poisson distributed count of other places visited on that day. If greater than 1 the following routine is called:
        <ol>
          <li>For the other places visited a random uniform value is picked from all possible feeding sites (iterate from 1:n.d)</li>
          <li>human i is added to the riskList at that randomly picked site, their pTm at that site is calculated as (1-p.d)/n.d</li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># add human i to the riskList
</span><span class="n">activitySpace.daily.Np.i</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ix</span><span class="p">){</span><span class="n">with</span><span class="p">(</span><span class="n">HUMANS</span><span class="p">[[</span><span class="n">i</span><span class="p">]],{</span>
    <span class="n">with</span><span class="p">(</span><span class="n">myTimeAtRisk</span><span class="p">,{</span>
        <span class="n">p.d</span> <span class="o">=</span> <span class="n">rbeta</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span> <span class="c1"># proportion of time at home today
</span>        <span class="n">add1toAtRisk.daily</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">hhID</span><span class="p">,</span> <span class="n">myID</span><span class="p">,</span> <span class="n">p.d</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">n.d</span> <span class="o">=</span> <span class="n">rpois</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nDaily</span><span class="p">)</span>   <span class="c1"># other places visited
</span>        <span class="k">if</span><span class="p">(</span><span class="n">n.d</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">n.d</span><span class="p">){</span>
            <span class="n">f.n</span> <span class="o">=</span> <span class="n">ceiling</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0.0000000001</span><span class="p">,</span><span class="n">Nplaces</span><span class="p">))</span>
            <span class="n">add1toAtRisk.daily</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">loc</span><span class="p">[</span><span class="n">f.n</span><span class="p">],</span> <span class="n">myID</span><span class="p">,(</span><span class="m">1</span><span class="o">-</span><span class="n">p.d</span><span class="p">)</span><span class="o">/</span><span class="n">n.d</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> 
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})}</span></code></pre></figure>

<p>Because the activitySpace function does not simulate human movement in terms of explicity journeys to and from destinations, but rather as a distribution of an individual’s <em>time at risk</em> across sites on the landscape, weighted by an individual level parameter of biting attractiveness, it is appropriate to visualize the distribution as a heatmap. In this visual representation, one can see how an individual’s time at risk varies over time. For each unique human in the simulation a hue is sampled with equal distance from all other hues on the color wheel. Each human’s time at risk at different sites is then represented by varying the luminosity of that hue at that site based on their contribution to the overall risk at that site.</p>

<center><embed src="http://smitdave.github.io/MASH-Development/images/risk.gif" width="512px" height="683px" /></center>

<h2 id="choosehost">chooseHost</h2>
<p>The chooseHost structures return the identity of the human host or other type of “host” encountered, whether livestock (perhaps treated with ivermectin), ~~sugar source~~, ATSB, or bloodtrap. The class “livestock” is set up by default, a master list for all types is set up in timeAtRisk.MICRO, and the associated functions are defined in the appropriate VECTOR.CONTROL component.</p>

<p>This documentation is described here in Activity Space because while it is called during the mosquito DHM cycle it is almost entirely a function of the riskList and other activitySpace objects.</p>

<p>The chooseHost.daily function locates the focal mosquito and then selects a host at that feeding site based on pTm * w (each human’s time at risk multiplied by their biting weight) as a multinomially distributed vector.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">chooseHost.daily</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">M</span><span class="p">){</span><span class="n">with</span><span class="p">(</span><span class="n">M</span><span class="p">,{</span>
    <span class="n">with</span><span class="p">(</span><span class="n">getAtRisk.daily</span><span class="p">(</span><span class="n">tnow</span><span class="p">),{</span>
        <span class="n">nn</span>  <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">pTm</span> <span class="o">=</span> <span class="n">pTm</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="n">nn</span><span class="p">]</span>
        <span class="n">who</span> <span class="o">=</span> <span class="n">Who</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="n">nn</span><span class="p">]</span>
        <span class="n">N</span>   <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">who</span><span class="p">)</span>
        <span class="n">ww</span>  <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="n">nn</span><span class="p">]</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">riskList</span><span class="o">$</span><span class="n">N.o</span><span class="p">){</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="m">+1</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">riskList</span><span class="o">$</span><span class="n">other</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">w</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
        <span class="n">who</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">who</span><span class="p">,</span><span class="n">riskList</span><span class="o">$</span><span class="n">other</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">typeID</span><span class="p">)</span>
        <span class="n">pTm</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">pTm</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">M</span><span class="o">$</span><span class="n">hostID</span> <span class="o">=</span> <span class="n">i.rmultinom</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="n">who</span><span class="p">,</span><span class="n">pr</span><span class="o">=</span><span class="n">ww</span><span class="o">*</span><span class="n">pTm</span><span class="p">))</span>
<span class="n">M</span><span class="p">})})}</span></code></pre></figure>


    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 MASH. All rights reserved. <br />
 Site last generated: Apr 4, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>

<p>Jekyll template downloaded from: <a href="https://github.com/tomjohnson1492/documentation-theme-jekyll">idratherbewriting</a></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>
